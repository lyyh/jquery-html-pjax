/**
 * htmlpajx插件
 * @authors liuyanhao (374659635@qq.com)
 * @date    2017-01-19 10:05:49
 * @version $0.2.0$
 */

!function(e,n,t){var a=e.location.href,i={selector:"a",container:"body",hash:"main",indexPage:"index.html",paths:"",refreshtoIndex:!0},r={refreshHandle:function(){onRefresh(function(){})},refreshToIndex:function(t){var i=this;if(i.onRefresh(function(){var n=null,t=e.location.href;e.history.pushState({origin:n},null,t)}),n("#"+t.hash)){var r="";a.indexOf(".html")>=0?(r=a.replace(a.substring(a.indexOf("#")),"#"+t.hash),e.location.href=r):e.location.href=a+t.indexPage+"#"+t.hash}},onRefresh:function(n){e.onbeforeunload=function(e){e.clientX>document.body.clientWidth&&e.clientY<0||e.altKey||n()}},init:function(t){var r=this;n(t.selector||t.selector).click(function(){var o=n(this).data("target"),l=e.location.href.split("#")[1]||t.hash||i.hash,h="",s="",f="";a.indexOf(".html")<0?a.indexOf("#")<0?h=(f=r.queryFilter())?a.replace(f,"")+(t.indexPage||i.indexPage)+"#"+o:a+(t.indexPage||i.indexPage)+"#"+o:((f=r.queryFilter())&&(h=a.replace(f,(t.indexPage||i.indexPage)+f)),s=a.substring(a.indexOf("#")),h=a.replace(s,(t.indexPage||i.indexPage)+"#"+o)):a.indexOf("#")<0?h=a+"#"+o:(s=a.substring(a.indexOf("#")),h=a.replace(s,"#"+o)),e.history.pushState({origin:l},null,h);var d=h.substring(h.lastIndexOf("/"));r.ajaxHandle(h.replace(d,"/"+t.paths+"/"+o+".html"),t.container)}),e.onpopstate=function(n){var a="",i=e.location.href,o=i.split("#")[1]||t.indexPage,l=i.substring(i.lastIndexOf("/"));a=i.indexOf("#")<0||i.indexOf("#"+t.hash)>=0?i.lastIndexOf("/")+1==i.length?i+t.paths+"/"+t.hash+".html":i.replace(l,"/"+t.paths+"/"+t.hash+".html"):(repStr=r.queryFilter(i))?i.replace(repStr,t.paths+"/"+o.replace(/\?.*/,"")+".html"):i.replace(l,"/"+t.paths+"/"+o+".html"),r.ajaxHandle(a,t.container)}},ajaxHandle:function(e,t){n.ajax({url:e,type:"get",dataType:"html",headers:{H_PJAX:!0}}).done(function(e){n(t).html(e)}).fail(function(){console.log("加载失败!")}).always(function(){})},queryFilter:function(e){var n="",t="",i=e||a;return!/\#.*\?/.test(i)&&(n=i.indexOf("?"))>=0?t=i.substring(n):/\#.*\?/.test(i)?t=i.substring(i.indexOf("#")):null}};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof module&&"object"==typeof exports?module.exports=r:jQuery?n.extend({htmlPjax:function(e){e.refreshtoIndex=e.refreshtoIndex||!0,e.refreshtoIndex||i.refreshtoIndex?r.refreshToIndex(e):r.refreshHandle(),r.init(e)}}):e.htmlPajx=r}(window,jQuery);